<!DOCTYPE html>
<html>
<head>
  <title>Indented Table with Drag and Drop</title>
  <style>
    td {
      padding-left: 20px;
    }
    .dragover {
      border: 2px dashed #aaa;
    }
  </style>
</head>
<body>
  <table id="myTable"></table>

  <script>
    // Sample array of elements
    let elements = [
      { name: 'Personal', father: '' },
      { name: 'rjara001@gmail.com', father: 'Personal' },
      { name: 'Rodrigo', father: 'Personal' },
      { name: 'D', father: 'Personal' },
      { name: 'E', father: 'Personal' }
    ];

    function createTable(elements) {
      const table = document.getElementById('myTable');

      elements.forEach(element => {
        const row = table.insertRow();
        const cell = row.insertCell();
        cell.textContent = element.name;

        // Calculate indentation level based on the depth of the element
        const indentationLevel = getIndentationLevel(elements, element);
        cell.style.paddingLeft = `${indentationLevel * 20}px`;

        // Add draggable attribute to the cell
        cell.draggable = true;
        cell.addEventListener('dragstart', dragStartHandler);
        cell.addEventListener('dragover', dragOverHandler);
        cell.addEventListener('dragleave', dragLeaveHandler);
        cell.addEventListener('drop', dropHandler);
      });
    }

    function getIndentationLevel(elements, element) {
      let indentationLevel = 0;
      let father = element.father;

      while (father !== '') {
        indentationLevel++;
        father = getParentName(elements, father);
      }

      return indentationLevel;
    }

    function getParentName(elements, name) {
      const parentElement = elements.find(element => element.name === name);
      return parentElement ? parentElement.father : '';
    }

    function dragStartHandler(event) {
      event.dataTransfer.setData('text/plain', event.target.textContent);
    }

    function dragOverHandler(event) {
      event.preventDefault();
      event.target.classList.add('dragover');
    }

    function dragLeaveHandler(event) {
      event.target.classList.remove('dragover');
    }

    function isChild(element, potentialChild) {
      let father = potentialChild.father;
      while (father !== '') {
        if (father === element.name) {
          return true;
        }
        father = getParentName(elements, father);
      }
      return false;
    }

    function dropHandler(event) {
      event.preventDefault();
      event.target.classList.remove('dragover');

      const sourceName = event.dataTransfer.getData('text/plain');
      const targetName = event.target.textContent;

      const sourceElement = elements.find(element => element.name === sourceName);
      const targetElement = elements.find(element => element.name === targetName);

      if (sourceElement && targetElement && !isChild(sourceElement, targetElement)) {
        // Update the father of the source element to match the target element's name
        sourceElement.father = targetElement.name;

        // Re-create the table to reflect the updated hierarchy
        clearTable();
        createTable(elements);
      }
    }

    function clearTable() {
      const table = document.getElementById('myTable');
      while (table.rows.length > 0) {
        table.deleteRow(0);
      }
    }

    // Create the table with the provided elements
    createTable(elements);
  </script>
</body>
</html>
